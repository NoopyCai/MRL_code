<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡æ§‹ç¨‹å¼ç¢¼æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-result {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .test-pass {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .test-fail {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .test-section {
            border-left: 4px solid #007bff;
            padding-left: 15px;
            margin: 15px 0;
        }
        h1 {
            color: #333;
            text-align: center;
        }
        h2 {
            color: #007bff;
            border-bottom: 2px solid #007bff;
            padding-bottom: 5px;
        }
        .summary {
            background: #e9ecef;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
        }
        .mock-elements {
            display: none;
        }
        #test-console {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin-top: 20px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
    </style>
</head>
<body>
    <h1>é‡æ§‹ç¨‹å¼ç¢¼æ¸¬è©¦å¥—ä»¶</h1>
    
    <!-- æ¨¡æ“¬æ‰€éœ€çš„ DOM å…ƒç´  -->
    <div class="mock-elements">
        <input id="email" type="email" value="">
        <input id="order-billing_address_lastname" type="text" value="">
        <input id="order-billing_address_firstname" type="text" value="">
        <input id="order-billing_address_city" type="text" value="">
        <select id="order-billing_address_city_id">
            <option value="1">å°åŒ—å¸‚</option>
        </select>
        <textarea id="notes"></textarea>
        <input type="radio" id="payment_method_1" name="payment_method" value="credit">
        <input type="checkbox" id="terms_agree" value="1">
        
        <div id="menuButton">Menu</div>
        <div id="menuContent"></div>
        <button id="saveDataBtn">å„²å­˜è³‡æ–™</button>
        <button id="loadTempDataBtn">è¼‰å…¥æš«å­˜è³‡æ–™</button>
        <button id="clearItems">æ¸…é™¤ç”¢å“</button>
        <div id="saveSuccessMessage"><p></p></div>
        <dialog id="userDataDialog"></dialog>
        <div id="popupContent"></div>
        <div id="initBlock"></div>
        <div id="tempDataList"></div>
        <input id="customerEmail" type="email">
        <button id="emailComfirm">ç¢ºèª</button>
        <div class="order-details"></div>
        <div id="order-items"></div>
        <div id="order-header">Create New Order</div>
    </div>

    <div class="test-container">
        <button onclick="runAllTests()">åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦</button>
        <button onclick="runStorageTests()">æ¸¬è©¦ StorageManager</button>
        <button onclick="runUITests()">æ¸¬è©¦ UIManager</button>
        <button onclick="runFormTests()">æ¸¬è©¦ FormManager</button>
        <button onclick="runOrderTests()">æ¸¬è©¦ OrderDataManager</button>
        <button onclick="clearTestData()">æ¸…é™¤æ¸¬è©¦è³‡æ–™</button>
    </div>

    <div id="test-results"></div>
    
    <div class="summary" id="test-summary"></div>
    
    <div id="test-console"></div>

    <script>
        /* =====================================
         * æ¸¬è©¦ç”¨é‡æ§‹ç¨‹å¼ç¢¼
         * ===================================== 
         * ä»¥ä¸‹ç¨‹å¼ç¢¼æ˜¯é‡æ§‹å¾Œå„å€‹é¡åˆ¥çš„ç°¡åŒ–ç‰ˆæœ¬ï¼Œç”¨æ–¼æ¸¬è©¦é©—è­‰
         * åŒ…å«äº† StorageManagerã€UIManagerã€FormManager ç­‰æ ¸å¿ƒæ¨¡çµ„
         */
        
        // ===== å¸¸æ•¸å®šç¾©å€å¡Š =====
        // ç‚ºä»€éº¼è¦é€™æ¨£è¨­è¨ˆï¼š
        // 1. é›†ä¸­ç®¡ç†æ‰€æœ‰é­”è¡“å­—ä¸²å’Œè¨­å®šå€¼ï¼Œé¿å…æ•£è½åœ¨ç¨‹å¼ç¢¼å„è™•
        // 2. æ–¹ä¾¿ç¶­è­·å’Œä¿®æ”¹ï¼Œç•¶éœ€è¦æ”¹è®Š localStorage key æ™‚åªéœ€ä¿®æ”¹ä¸€è™•
        // 3. æé«˜ç¨‹å¼ç¢¼å¯è®€æ€§ï¼Œè®“å…¶ä»–é–‹ç™¼è€…èƒ½å¿«é€Ÿç†è§£ç³»çµ±é…ç½®
        const LOCAL_STORAGE_KEYS = {
            USER_DATA: 'allUserData',
            CACHED_ITEM_IDS: 'allCachedItemIDs',
            ITEM_DATA: 'allItemData'
        };

        // CSS é¡åˆ¥åç¨±å¸¸æ•¸
        // ç›®çš„ï¼šçµ±ä¸€ç®¡ç†æ‰€æœ‰ CSS é¡åˆ¥åç¨±ï¼Œé¿å…æ‹¼å­—éŒ¯èª¤å’Œé‡è¤‡å®šç¾©
        const CSS_CLASSES = {
            VISIBLE: 'show',
            DIALOG_OPTION: 'dialogOption',
            DELETE_BUTTON: 'deleteButton',
            ORDER_TABLES: 'order-tables',
            EMPTY_TEXT: 'empty-text'
        };

        // DOM é¸æ“‡å™¨å¸¸æ•¸
        // ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆï¼š
        // 1. é›†ä¸­ç®¡ç†æ‰€æœ‰ DOM é¸æ“‡å™¨ï¼Œç•¶ HTML çµæ§‹æ”¹è®Šæ™‚åªéœ€ä¿®æ”¹ä¸€è™•
        // 2. é¿å…åœ¨ç¨‹å¼ç¢¼ä¸­ç¡¬ç·¨ç¢¼é¸æ“‡å™¨å­—ä¸²ï¼Œæé«˜ç¶­è­·æ€§
        // 3. é€éå¸¸æ•¸åç¨±æä¾›æ›´å¥½çš„ç¨‹å¼ç¢¼èªæ„æ€§
        const SELECTORS = {
            EMAIL_FIELD: '#email',
            LAST_NAME_FIELD: '#order-billing_address_lastname',
            FIRST_NAME_FIELD: '#order-billing_address_firstname',
            MENU_BUTTON: '#menuButton',
            MENU_CONTENT: '#menuContent',
            SAVE_DATA_BTN: '#saveDataBtn',
            CLEAR_ITEMS: '#clearItems',
            LOAD_TEMP_DATA_BTN: '#loadTempDataBtn',
            USER_DATA_DIALOG: '#userDataDialog',
            POPUP_CONTENT: '#popupContent',
            SAVE_SUCCESS_MESSAGE: '#saveSuccessMessage',
            INIT_BLOCK: '#initBlock',
            CUSTOMER_EMAIL: '#customerEmail',
            EMAIL_CONFIRM: '#emailComfirm',
            TEMP_DATA_LIST: '#tempDataList',
            ORDER_DETAILS: '.order-details',
            ORDER_ITEMS: '#order-items',
            ORDER_HEADER: '#order-header'
        };

        // è¡¨å–®æ¬„ä½é¡å‹å¸¸æ•¸
        // ç”¨é€”ï¼šæ¨™æº–åŒ–è¡¨å–®æ¬„ä½é¡å‹çš„åˆ¤æ–·ï¼Œé¿å…æ‹¼å­—éŒ¯èª¤
        const FIELD_TYPES = {
            RADIO: 'radio',
            CHECKBOX: 'checkbox',
            FIELDSET: 'fieldset'
        };

        // ç³»çµ±é…ç½®å¸¸æ•¸
        // ç‚ºä»€éº¼å°‡é€™äº›å€¼è¨­ç‚ºå¸¸æ•¸ï¼š
        // 1. æ–¹ä¾¿èª¿æ•´ç³»çµ±åƒæ•¸ï¼Œå¦‚è³‡æ–™éæœŸæ™‚é–“ã€è¨Šæ¯é¡¯ç¤ºæ™‚é–“ç­‰
        // 2. é›†ä¸­ç®¡ç†æ‰€æœ‰æ™‚é–“å’Œæ­£å‰‡è¡¨é”å¼è¨­å®š
        // 3. è®“ç¨‹å¼ç¢¼æ›´å…·å¯è®€æ€§ï¼Œä¸€çœ¼å°±èƒ½çœ‹å‡ºå„ç¨®è¨­å®šå€¼çš„ç”¨é€”
        const CONFIG = {
            DATA_EXPIRY_TIME: 48 * 60 * 60 * 1000,        // 48å°æ™‚ï¼ˆæ¯«ç§’ï¼‰
            SUCCESS_MESSAGE_DISPLAY_TIME: 3000,           // 3ç§’
            PRODUCT_REMOVAL_DELAY: 1500,                  // 1.5ç§’
            EMAIL_FORMAT_REGEX: /^[^\s@]+@[^\s@]+\.[^\s@]+$/  // Email æ ¼å¼é©—è­‰
        };

        // ä½¿ç”¨è€…è¨Šæ¯å¸¸æ•¸
        // å„ªé»ï¼š
        // 1. çµ±ä¸€ç®¡ç†æ‰€æœ‰ä½¿ç”¨è€…çœ‹åˆ°çš„æ–‡å­—è¨Šæ¯
        // 2. æ–¹ä¾¿é€²è¡Œå¤šèªç³»åŒ–ï¼ˆi18nï¼‰
        // 3. é¿å…åœ¨ç¨‹å¼ç¢¼ä¸­æ•£è½é‡è¤‡çš„æ–‡å­—å­—ä¸²
        const MESSAGES = {
            DATA_SAVED: 'è³‡æ–™å·²å„²å­˜!',
            FIELD_SAVED_SUCCESS: 'æ¬„ä½å·²æˆåŠŸå„²å­˜!',
            CONFIRM_CLEAR_ITEMS: 'ç¢ºå®šæ¸…é™¤ç”¢å“æ¸…å–®å—?',
            PLEASE_INPUT_EMAIL: 'è«‹è¼¸å…¥Email',
            EMAIL_CHANGED_ALERT: 'åŸå„²å­˜è³‡æ–™çš„Emailå·²è¢«æ›´æ”¹ï¼Œå·²è‡ªå‹•æ›´æ–°æš«å­˜è³‡æ–™',
            NO_TEMP_DATA: 'ç›®å‰æ²’æœ‰ä»»ä½•æš«å­˜è³‡æ–™ã€‚',
            NO_CUSTOMER_DATA: 'æ­¤å®¢æˆ¶ç›®å‰æ²’æœ‰ä»»ä½•æš«å­˜è³‡æ–™ã€‚'
        };

        /* =====================================
         * StorageManager é¡åˆ¥
         * ===================================== 
         * åŠŸèƒ½ï¼šå°ˆé–€è™•ç† localStorage çš„è³‡æ–™å­˜å–
         * è¨­è¨ˆç†å¿µï¼š
         * 1. å–®ä¸€è·è²¬åŸå‰‡ï¼šåªè² è²¬è³‡æ–™å„²å­˜å’Œè®€å–
         * 2. éŒ¯èª¤è™•ç†ï¼šæä¾›å®Œæ•´çš„ä¾‹å¤–è™•ç†æ©Ÿåˆ¶
         * 3. è³‡æ–™å®‰å…¨ï¼šç¢ºä¿è³‡æ–™çš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§
         */
        class StorageManager {
            constructor() {
                // åˆå§‹åŒ–æ™‚è¨­å®šå„²å­˜éµå€¼ï¼Œæ–¹ä¾¿çµ±ä¸€ç®¡ç†
                this.storageKeys = LOCAL_STORAGE_KEYS;
            }

            /**
             * å¾ localStorage è®€å–è³‡æ–™
             * @param {string} key - å„²å­˜éµå€¼
             * @param {*} defaultValue - é è¨­å€¼ï¼ˆç•¶è³‡æ–™ä¸å­˜åœ¨æˆ–è§£æå¤±æ•—æ™‚è¿”å›ï¼‰
             * @returns {*} è§£æå¾Œçš„è³‡æ–™æˆ–é è¨­å€¼
             * 
             * ç‚ºä»€éº¼éœ€è¦ try-catchï¼š
             * 1. localStorage å¯èƒ½è¢«ç¦ç”¨ï¼ˆéš±ç§æ¨¡å¼ï¼‰
             * 2. å„²å­˜çš„è³‡æ–™å¯èƒ½ææ¯€ç„¡æ³•è§£æ
             * 3. æä¾›å„ªé›…çš„éŒ¯èª¤è™•ç†ï¼Œä¸è®“ç¨‹å¼å´©æ½°
             */
            getLocalStorageData(key, defaultValue = {}) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : defaultValue;
                } catch (error) {
                    console.error(`Error parsing localStorage data for key "${key}":`, error);
                    return defaultValue;
                }
            }

            /**
             * å°‡è³‡æ–™å„²å­˜åˆ° localStorage
             * @param {string} key - å„²å­˜éµå€¼
             * @param {*} data - è¦å„²å­˜çš„è³‡æ–™
             * @returns {boolean} æ˜¯å¦å„²å­˜æˆåŠŸ
             * 
             * ç‚ºä»€éº¼å›å‚³å¸ƒæ—å€¼ï¼š
             * 1. è®“å‘¼å«è€…çŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸ
             * 2. å¯ä»¥æ ¹æ“šå›å‚³å€¼æ±ºå®šå¾ŒçºŒå‹•ä½œï¼ˆå¦‚é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯ï¼‰
             */
            setLocalStorageData(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error(`Error saving data to localStorage for key "${key}":`, error);
                    return false;
                }
            }

            /**
             * å¾ localStorage ç§»é™¤è³‡æ–™
             * @param {string} key - è¦ç§»é™¤çš„éµå€¼
             * 
             * è¨­è¨ˆè€ƒé‡ï¼šå³ä½¿ç§»é™¤å¤±æ•—ä¹Ÿä¸æœƒæ‹‹å‡ºéŒ¯èª¤ï¼Œä¿æŒç¨‹å¼ç©©å®šæ€§
             */
            removeLocalStorageData(key) {
                try {
                    localStorage.removeItem(key);
                } catch (error) {
                    console.error(`Error removing localStorage data for key "${key}":`, error);
                }
            }

            /**
             * å–å¾—æ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™
             * @returns {Object} æ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™çš„ç‰©ä»¶
             * 
             * è¨­è¨ˆç›®çš„ï¼šæä¾›çµ±ä¸€çš„è³‡æ–™å­˜å–ä»‹é¢
             */
            getAllUserData() {
                return this.getLocalStorageData(this.storageKeys.USER_DATA);
            }

            /**
             * å„²å­˜ç‰¹å®šä½¿ç”¨è€…çš„è³‡æ–™
             * @param {string} email - ä½¿ç”¨è€… emailï¼ˆä½œç‚ºå”¯ä¸€è­˜åˆ¥ç¢¼ï¼‰
             * @param {Object} userData - ä½¿ç”¨è€…è³‡æ–™
             * @returns {boolean} æ˜¯å¦å„²å­˜æˆåŠŸ
             * 
             * è¨­è¨ˆé‡é»ï¼š
             * 1. ä½¿ç”¨ email ä½œç‚ºå”¯ä¸€éµå€¼ï¼Œå› ç‚º email åœ¨ç³»çµ±ä¸­æ˜¯å”¯ä¸€çš„
             * 2. è‡ªå‹•æ·»åŠ æ™‚é–“æˆ³ï¼Œæ–¹ä¾¿è¿½è¹¤è³‡æ–™å»ºç«‹/æ›´æ–°æ™‚é–“
             * 3. ä½¿ç”¨å±•é–‹é‹ç®—ç¬¦ï¼ˆ...ï¼‰ä¿ç•™åŸæœ‰è³‡æ–™ï¼Œåªæ›´æ–°ç‰¹å®šä½¿ç”¨è€…
             */
            saveUserData(email, userData) {
                const allUserData = this.getAllUserData();
                allUserData[email] = {
                    ...userData,
                    timestamp: new Date().getTime()  // è‡ªå‹•æ·»åŠ æ™‚é–“æˆ³
                };
                return this.setLocalStorageData(this.storageKeys.USER_DATA, allUserData);
            }

            /**
             * å–å¾—ç‰¹å®šä½¿ç”¨è€…çš„è³‡æ–™
             * @param {string} email - ä½¿ç”¨è€… email
             * @returns {Object|null} ä½¿ç”¨è€…è³‡æ–™æˆ– nullï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
             * 
             * ç‚ºä»€éº¼å›å‚³ nullï¼š
             * 1. æ˜ç¢ºè¡¨ç¤ºè³‡æ–™ä¸å­˜åœ¨ï¼Œè€Œéç©ºç‰©ä»¶
             * 2. æ–¹ä¾¿å‘¼å«è€…é€²è¡Œæ¢ä»¶åˆ¤æ–·
             */
            getUserData(email) {
                const allUserData = this.getAllUserData();
                return allUserData[email] || null;
            }

            /**
             * åˆªé™¤ç‰¹å®šä½¿ç”¨è€…çš„è³‡æ–™
             * @param {string} email - è¦åˆªé™¤çš„ä½¿ç”¨è€… email
             * @returns {boolean} æ˜¯å¦åˆªé™¤æˆåŠŸ
             * 
             * é‚è¼¯è¨­è¨ˆï¼š
             * 1. å¦‚æœåˆªé™¤å¾Œé‚„æœ‰å…¶ä»–ä½¿ç”¨è€…è³‡æ–™ï¼Œå‰‡æ›´æ–° localStorage
             * 2. å¦‚æœæ²’æœ‰ä»»ä½•è³‡æ–™äº†ï¼Œå‰‡å®Œå…¨ç§»é™¤è©² keyï¼Œä¿æŒ localStorage æ•´æ½”
             */
            deleteUserData(email) {
                const allUserData = this.getAllUserData();
                delete allUserData[email];
                
                if (Object.keys(allUserData).length > 0) {
                    return this.setLocalStorageData(this.storageKeys.USER_DATA, allUserData);
                } else {
                    this.removeLocalStorageData(this.storageKeys.USER_DATA);
                    return true;
                }
            }
        }

        /* =====================================
         * UIManager é¡åˆ¥
         * ===================================== 
         * åŠŸèƒ½ï¼šå°ˆé–€è™•ç† DOM æ“ä½œå’Œä½¿ç”¨è€…ä»‹é¢é‚è¼¯
         * è¨­è¨ˆç†å¿µï¼š
         * 1. åˆ†é›¢é—œæ³¨é»ï¼šå°‡ UI æ“ä½œå¾æ¥­å‹™é‚è¼¯ä¸­åˆ†é›¢
         * 2. å…ƒç´ å¿«å–ï¼šæé«˜æ•ˆèƒ½ï¼Œé¿å…é‡è¤‡æŸ¥è©¢ DOM
         * 3. çµ±ä¸€ç®¡ç†ï¼šæ‰€æœ‰ UI ç›¸é—œæ“ä½œéƒ½åœ¨é€™è£¡è™•ç†
         */
        class UIManager {
            constructor() {
                // åˆå§‹åŒ–æ™‚å°±å¿«å–æ‰€æœ‰éœ€è¦çš„ DOM å…ƒç´ ï¼Œæé«˜å¾ŒçºŒæ“ä½œæ•ˆèƒ½
                this.elements = this._cacheElements();
                this.menuIsOpen = false;  // è¿½è¹¤é¸å–®ç‹€æ…‹
            }

            /**
             * å¿«å–å¸¸ç”¨çš„ DOM å…ƒç´ 
             * @returns {Object} å¿«å–çš„å…ƒç´ ç‰©ä»¶
             * 
             * ç‚ºä»€éº¼è¦å¿«å–å…ƒç´ ï¼š
             * 1. æ•ˆèƒ½å„ªåŒ–ï¼šé¿å…é‡è¤‡çš„ DOM æŸ¥è©¢
             * 2. éŒ¯èª¤è™•ç†ï¼šé›†ä¸­è™•ç†å…ƒç´ ä¸å­˜åœ¨çš„æƒ…æ³
             * 3. ç¶­è­·æ€§ï¼šç•¶é¸æ“‡å™¨æ”¹è®Šæ™‚ï¼Œåªéœ€æ›´æ–° SELECTORS å¸¸æ•¸
             */
            _cacheElements() {
                const elements = {};
                Object.entries(SELECTORS).forEach(([key, selector]) => {
                    const element = document.querySelector(selector);
                    if (element) {
                        elements[key] = element;
                    }
                });
                return elements;
            }

            /**
             * å–å¾—å¿«å–çš„ DOM å…ƒç´ 
             * @param {string} elementKey - å…ƒç´ éµå€¼ï¼ˆå°æ‡‰ SELECTORS ä¸­çš„ keyï¼‰
             * @returns {Element|null} DOM å…ƒç´ æˆ– null
             * 
             * æ™ºèƒ½å¿«å–é‚è¼¯ï¼š
             * 1. å„ªå…ˆå›å‚³å·²å¿«å–çš„å…ƒç´ 
             * 2. å¦‚æœæ²’æœ‰å¿«å–ï¼Œå‰‡å³æ™‚æŸ¥è©¢ä¸¦å¿«å–
             * 3. å¦‚æœæ‰¾ä¸åˆ°å…ƒç´ ï¼Œå›å‚³ null é¿å…éŒ¯èª¤
             */
            getElement(elementKey) {
                if (this.elements[elementKey]) {
                    return this.elements[elementKey];
                }
                
                const selector = SELECTORS[elementKey];
                if (selector) {
                    const element = document.querySelector(selector);
                    if (element) {
                        this.elements[elementKey] = element;  // å‹•æ…‹å¿«å–æ–°æ‰¾åˆ°çš„å…ƒç´ 
                        return element;
                    }
                }
                
                return null;
            }

            /**
             * é¡¯ç¤ºå„²å­˜æˆåŠŸè¨Šæ¯
             * @param {string} message - è¦é¡¯ç¤ºçš„è¨Šæ¯
             * 
             * ä½¿ç”¨è€…é«”é©—è¨­è¨ˆï¼š
             * 1. æä¾›è¦–è¦ºåŒ–å›é¥‹ï¼Œè®“ä½¿ç”¨è€…çŸ¥é“æ“ä½œæˆåŠŸ
             * 2. è‡ªå‹•æ¶ˆå¤±æ©Ÿåˆ¶ï¼Œé¿å…è¨Šæ¯éä¹…åœç•™
             * 3. å®¹éŒ¯è¨­è¨ˆï¼šå¦‚æœå…ƒç´ ä¸å­˜åœ¨ä¸æœƒæ‹‹å‡ºéŒ¯èª¤
             */
            showSaveSuccessMessage(message = MESSAGES.FIELD_SAVED_SUCCESS) {
                const messageElement = this.getElement('SAVE_SUCCESS_MESSAGE');
                if (messageElement) {
                    const textElement = messageElement.querySelector('p');
                    if (textElement) {
                        textElement.textContent = message;
                    }
                    messageElement.classList.add(CSS_CLASSES.VISIBLE);
                    
                    // è¨­å®šè‡ªå‹•éš±è—ï¼Œæ”¹å–„ä½¿ç”¨è€…é«”é©—
                    setTimeout(() => {
                        messageElement.classList.remove(CSS_CLASSES.VISIBLE);
                    }, CONFIG.SUCCESS_MESSAGE_DISPLAY_TIME);
                }
            }

            /**
             * åˆ‡æ›é¸å–®é–‹é—œç‹€æ…‹
             * 
             * äº’å‹•è¨­è¨ˆåŸç†ï¼š
             * 1. ç‹€æ…‹è¿½è¹¤ï¼šä½¿ç”¨ boolean è®Šæ•¸è¿½è¹¤é¸å–®ç‹€æ…‹
             * 2. è¦–è¦ºå›é¥‹ï¼šé€é CSS æ¨£å¼è®ŠåŒ–æä¾›å³æ™‚åæ‡‰
             * 3. ä¸€è‡´æ€§ï¼šé–‹é—œè¡Œç‚ºä¿æŒä¸€è‡´ï¼Œé¿å…ä½¿ç”¨è€…å›°æƒ‘
             */
            toggleMenu() {
                const menuContent = this.getElement('MENU_CONTENT');
                if (menuContent) {
                    this.menuIsOpen = !this.menuIsOpen;  // åˆ‡æ›ç‹€æ…‹
                    
                    if (this.menuIsOpen) {
                        menuContent.style.width = '120px';
                        menuContent.style.height = '150px';
                    } else {
                        menuContent.style.width = '0';
                        menuContent.style.height = '0';
                    }
                }
            }

            showAlert(message) {
                console.log(`Alert: ${message}`);
                return true;
            }

            showConfirm(message) {
                console.log(`Confirm: ${message}`);
                return true;
            }
        }

        // FormManager é¡åˆ¥
        class FormManager {
            constructor() {
                this.fieldIds = [];
                this.fields = {};
                this._initializeFields();
            }

            _initializeFields() {
                this._collectFieldIds();
                this._cacheFieldElements();
            }

            _collectFieldIds() {
                const allInputs = document.querySelectorAll('input');
                const allSelects = document.querySelectorAll('select');
                const allTextareas = document.querySelectorAll('textarea');

                [allInputs, allSelects, allTextareas].forEach(nodeList => {
                    nodeList.forEach(element => {
                        if (element.id && element.id.trim() !== '') {
                            this.fieldIds.push(element.id);
                        }
                    });
                });

                this.fieldIds = [...new Set(this.fieldIds)];
            }

            _cacheFieldElements() {
                this.fieldIds.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        this.fields[id] = element;
                    }
                });
            }

            getField(fieldId) {
                return this.fields[fieldId] || document.getElementById(fieldId);
            }

            validateEmail(email) {
                if (!email || typeof email !== 'string') {
                    return false;
                }
                return CONFIG.EMAIL_FORMAT_REGEX.test(email.trim());
            }

            setFieldValue(fieldId, value) {
                const field = this.getField(fieldId);
                if (!field) return false;

                try {
                    switch (field.type) {
                        case FIELD_TYPES.RADIO:
                            field.checked = true;
                            break;
                        case FIELD_TYPES.CHECKBOX:
                            field.checked = Boolean(value);
                            break;
                        default:
                            field.value = value || '';
                            break;
                    }
                    return true;
                } catch (error) {
                    console.error(`Error setting field value for ${fieldId}:`, error);
                    return false;
                }
            }

            getFieldValue(field) {
                if (!field) return null;

                try {
                    switch (field.type) {
                        case FIELD_TYPES.RADIO:
                            return field.checked ? field.value : null;
                        case FIELD_TYPES.CHECKBOX:
                            return field.checked;
                        default:
                            return field.value;
                    }
                } catch (error) {
                    console.error(`Error getting field value:`, error);
                    return null;
                }
            }

            getUserBasicInfo() {
                const emailField = document.querySelector(SELECTORS.EMAIL_FIELD);
                const lastNameField = document.querySelector(SELECTORS.LAST_NAME_FIELD);
                const firstNameField = document.querySelector(SELECTORS.FIRST_NAME_FIELD);

                return {
                    email: emailField ? emailField.value.trim() : '',
                    lastName: lastNameField ? lastNameField.value.trim() : '',
                    firstName: firstNameField ? firstNameField.value.trim() : '',
                    fullName: this._getFullName(lastNameField, firstNameField)
                };
            }

            _getFullName(lastNameField, firstNameField) {
                const lastName = lastNameField ? lastNameField.value.trim() : '';
                const firstName = firstNameField ? firstNameField.value.trim() : '';
                return `${lastName}${firstName}`.trim();
            }
        }

        /* =====================================
         * æ¸¬è©¦æ¡†æ¶ TestRunner
         * ===================================== 
         * åŠŸèƒ½ï¼šæä¾›å®Œæ•´çš„æ¸¬è©¦åŸ·è¡Œå’Œçµæœç®¡ç†æ©Ÿåˆ¶
         * è¨­è¨ˆç†å¿µï¼š
         * 1. æ¨¡çµ„åŒ–æ¸¬è©¦ï¼šæ¯å€‹åŠŸèƒ½æ¨¡çµ„ç¨ç«‹æ¸¬è©¦
         * 2. çµæœè¿½è¹¤ï¼šè¨˜éŒ„æ‰€æœ‰æ¸¬è©¦çµæœå’Œçµ±è¨ˆè³‡è¨Š
         * 3. è¦–è¦ºåŒ–å›é¥‹ï¼šæä¾›æ¸…æ¥šçš„æ¸¬è©¦çµæœé¡¯ç¤º
         */
        class TestRunner {
            constructor() {
                this.tests = [];         // æ¸¬è©¦é …ç›®æ¸…å–®
                this.results = [];       // æ¸¬è©¦çµæœè¨˜éŒ„
                this.console = document.getElementById('test-console');  // æ—¥èªŒè¼¸å‡ºå€åŸŸ
            }

            log(message) {
                this.console.textContent += `${new Date().toLocaleTimeString()}: ${message}\n`;
                this.console.scrollTop = this.console.scrollHeight;
            }

            assert(condition, message) {
                const result = {
                    passed: condition,
                    message: message,
                    timestamp: new Date().toLocaleTimeString()
                };
                this.results.push(result);
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `test-result ${condition ? 'test-pass' : 'test-fail'}`;
                resultDiv.textContent = `${condition ? 'âœ…' : 'âŒ'} ${message}`;
                
                return result;
            }

            displayResults() {
                const container = document.getElementById('test-results');
                container.innerHTML = '';
                
                this.results.forEach(result => {
                    const div = document.createElement('div');
                    div.className = `test-result ${result.passed ? 'test-pass' : 'test-fail'}`;
                    div.textContent = `${result.passed ? 'âœ…' : 'âŒ'} ${result.message}`;
                    container.appendChild(div);
                });

                this.updateSummary();
            }

            updateSummary() {
                const summary = document.getElementById('test-summary');
                const total = this.results.length;
                const passed = this.results.filter(r => r.passed).length;
                const failed = total - passed;
                
                summary.innerHTML = `
                    <h3>æ¸¬è©¦çµæœç¸½çµ</h3>
                    <p>ç¸½æ¸¬è©¦æ•¸: ${total}</p>
                    <p style="color: green;">é€šé: ${passed}</p>
                    <p style="color: red;">å¤±æ•—: ${failed}</p>
                    <p>æˆåŠŸç‡: ${total > 0 ? Math.round((passed / total) * 100) : 0}%</p>
                `;
            }

            clear() {
                this.results = [];
                document.getElementById('test-results').innerHTML = '';
                document.getElementById('test-summary').innerHTML = '';
                this.console.textContent = '';
            }
        }

        const testRunner = new TestRunner();

        /* =====================================
         * æ¸¬è©¦å‡½å¼å€å¡Š
         * ===================================== 
         * æ¯å€‹æ¸¬è©¦å‡½å¼éƒ½å°ˆé–€æ¸¬è©¦ä¸€å€‹ç‰¹å®šçš„æ¨¡çµ„
         * æ¸¬è©¦è¨­è¨ˆåŸå‰‡ï¼š
         * 1. ç¨ç«‹æ€§ï¼šæ¯å€‹æ¸¬è©¦éƒ½èƒ½ç¨ç«‹åŸ·è¡Œ
         * 2. å®Œæ•´æ€§ï¼šæ¶µè“‹æ­£å¸¸æƒ…æ³å’Œé‚Šç·£æƒ…æ³
         * 3. å¯é‡è¤‡æ€§ï¼šå¤šæ¬¡åŸ·è¡Œçµæœä¸€è‡´
         */
        
        /**
         * StorageManager æ¸¬è©¦å‡½å¼
         * 
         * æ¸¬è©¦ç›®æ¨™ï¼šé©—è­‰è³‡æ–™å„²å­˜ã€è®€å–ã€åˆªé™¤åŠŸèƒ½çš„æ­£ç¢ºæ€§
         * æ¸¬è©¦ç­–ç•¥ï¼š
         * 1. åŸºæœ¬ CRUD æ“ä½œæ¸¬è©¦ï¼ˆå»ºç«‹ã€è®€å–ã€æ›´æ–°ã€åˆªé™¤ï¼‰
         * 2. é‚Šç·£æƒ…æ³æ¸¬è©¦ï¼ˆä¸å­˜åœ¨çš„è³‡æ–™ã€ç©ºå€¼è™•ç†ï¼‰
         * 3. éŒ¯èª¤è™•ç†æ¸¬è©¦ï¼ˆç¢ºä¿ç¨‹å¼ä¸æœƒå´©æ½°ï¼‰
         */
        function runStorageTests() {
            testRunner.log('é–‹å§‹ StorageManager æ¸¬è©¦...');
            
            const storage = new StorageManager();
            
            // å‰ç½®ä½œæ¥­ï¼šæ¸…é™¤èˆŠè³‡æ–™ï¼Œç¢ºä¿æ¸¬è©¦ç’°å¢ƒä¹¾æ·¨
            // ç‚ºä»€éº¼éœ€è¦æ¸…é™¤ï¼šé¿å…ä¹‹å‰çš„æ¸¬è©¦è³‡æ–™å½±éŸ¿æœ¬æ¬¡æ¸¬è©¦çµæœ
            localStorage.removeItem('allUserData');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 1ï¼šåŸºæœ¬å„²å­˜åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰è³‡æ–™èƒ½å¦æ­£ç¢ºå„²å­˜åˆ° localStorage
            const testData = {
                email: 'test@example.com',
                name: 'Test User',
                data: { field1: 'value1' }
            };
            
            const saveResult = storage.saveUserData(testData.email, testData);
            testRunner.assert(saveResult, 'StorageManager: æ‡‰è©²èƒ½å¤ å„²å­˜ä½¿ç”¨è€…è³‡æ–™');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 2ï¼šè³‡æ–™è®€å–åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰å‰›æ‰å„²å­˜çš„è³‡æ–™èƒ½å¦æ­£ç¢ºè®€å–
            // é‡è¦ï¼šæ¸¬è©¦è³‡æ–™å®Œæ•´æ€§ï¼Œç¢ºä¿æ²’æœ‰è³‡æ–™éºå¤±æˆ–ææ¯€
            const retrievedData = storage.getUserData(testData.email);
            testRunner.assert(retrievedData !== null, 'StorageManager: æ‡‰è©²èƒ½å¤ è®€å–å„²å­˜çš„è³‡æ–™');
            testRunner.assert(retrievedData.email === testData.email, 'StorageManager: è®€å–çš„ email æ‡‰è©²æ­£ç¢º');
            testRunner.assert(retrievedData.name === testData.name, 'StorageManager: è®€å–çš„ name æ‡‰è©²æ­£ç¢º');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 3ï¼šå–å¾—æ‰€æœ‰è³‡æ–™åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰æ‰¹é‡è³‡æ–™è®€å–åŠŸèƒ½
            const allData = storage.getAllUserData();
            testRunner.assert(Object.keys(allData).length > 0, 'StorageManager: æ‡‰è©²èƒ½å¤ å–å¾—æ‰€æœ‰ä½¿ç”¨è€…è³‡æ–™');
            testRunner.assert(allData[testData.email] !== undefined, 'StorageManager: æ‰€æœ‰è³‡æ–™ä¸­æ‡‰è©²åŒ…å«æ¸¬è©¦è³‡æ–™');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 4ï¼šè³‡æ–™åˆªé™¤åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰è³‡æ–™èƒ½å¦æ­£ç¢ºåˆªé™¤ï¼Œä¸ç•™æ®˜é¤˜
            const deleteResult = storage.deleteUserData(testData.email);
            testRunner.assert(deleteResult, 'StorageManager: æ‡‰è©²èƒ½å¤ åˆªé™¤ä½¿ç”¨è€…è³‡æ–™');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 5ï¼šåˆªé™¤å¾Œé©—è­‰
            // ç›®çš„ï¼šç¢ºèªè³‡æ–™çœŸçš„è¢«åˆªé™¤ï¼Œè€Œéåªæ˜¯æ¨™è¨˜åˆªé™¤
            const deletedData = storage.getUserData(testData.email);
            testRunner.assert(deletedData === null, 'StorageManager: åˆªé™¤å¾Œæ‡‰è©²ç„¡æ³•æ‰¾åˆ°è³‡æ–™');
            
            testRunner.log('StorageManager æ¸¬è©¦å®Œæˆ');
            testRunner.displayResults();
        }

        /**
         * UIManager æ¸¬è©¦å‡½å¼
         * 
         * æ¸¬è©¦ç›®æ¨™ï¼šé©—è­‰ UI æ“ä½œå’Œ DOM ç®¡ç†åŠŸèƒ½
         * æ¸¬è©¦é‡é»ï¼š
         * 1. DOM å…ƒç´ æŸ¥è©¢å’Œå¿«å–æ©Ÿåˆ¶
         * 2. ä½¿ç”¨è€…ä»‹é¢äº’å‹•åŠŸèƒ½ï¼ˆé¸å–®ã€è¨Šæ¯é¡¯ç¤ºï¼‰
         * 3. ç‹€æ…‹ç®¡ç†ï¼ˆé–‹é—œç‹€æ…‹è¿½è¹¤ï¼‰
         * 
         * ç‚ºä»€éº¼è¦æ¸¬è©¦ UIï¼š
         * UI æ˜¯ä½¿ç”¨è€…ç›´æ¥æ¥è§¸çš„éƒ¨åˆ†ï¼Œä»»ä½•éŒ¯èª¤éƒ½æœƒç›´æ¥å½±éŸ¿ä½¿ç”¨è€…é«”é©—
         */
        function runUITests() {
            testRunner.log('é–‹å§‹ UIManager æ¸¬è©¦...');
            
            const ui = new UIManager();
            
            // æ¸¬è©¦æ¡ˆä¾‹ 1ï¼šDOM å…ƒç´ å¿«å–æ©Ÿåˆ¶
            // ç›®çš„ï¼šé©—è­‰å…ƒç´ å¿«å–åŠŸèƒ½æ˜¯å¦æ­£å¸¸ï¼Œé€™ç›´æ¥å½±éŸ¿ç¨‹å¼æ•ˆèƒ½
            // é‡è¦æ€§ï¼šå¿«å–æ©Ÿåˆ¶å¤±æ•ˆæœƒå°è‡´é‡è¤‡æŸ¥è©¢ DOMï¼Œå½±éŸ¿æ•ˆèƒ½
            const emailElement = ui.getElement('EMAIL_FIELD');
            testRunner.assert(emailElement !== null, 'UIManager: æ‡‰è©²èƒ½å¤ å–å¾— email æ¬„ä½å…ƒç´ ');
            testRunner.assert(emailElement.id === 'email', 'UIManager: å–å¾—çš„ email å…ƒç´  ID æ‡‰è©²æ­£ç¢º');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 2-3ï¼šé¸å–®åˆ‡æ›åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰é¸å–®é–‹é—œé‚è¼¯çš„æ­£ç¢ºæ€§
            // æ¸¬è©¦é‚è¼¯ï¼šé–‹å•Ÿ -> æª¢æŸ¥ç‹€æ…‹ -> é—œé–‰ -> æª¢æŸ¥ç‹€æ…‹
            const menuContent = ui.getElement('MENU_CONTENT');
            
            // ç¬¬ä¸€æ¬¡åˆ‡æ›ï¼šé—œé–‰ -> é–‹å•Ÿ
            ui.toggleMenu();
            testRunner.assert(ui.menuIsOpen === true, 'UIManager: åˆ‡æ›é¸å–®å¾Œæ‡‰è©²æ˜¯é–‹å•Ÿç‹€æ…‹');
            testRunner.assert(menuContent.style.width === '120px', 'UIManager: é–‹å•Ÿé¸å–®æ™‚å¯¬åº¦æ‡‰è©²æ˜¯ 120px');
            
            // ç¬¬äºŒæ¬¡åˆ‡æ›ï¼šé–‹å•Ÿ -> é—œé–‰
            ui.toggleMenu();
            testRunner.assert(ui.menuIsOpen === false, 'UIManager: å†æ¬¡åˆ‡æ›é¸å–®å¾Œæ‡‰è©²æ˜¯é—œé–‰ç‹€æ…‹');
            testRunner.assert(menuContent.style.width === '0', 'UIManager: é—œé–‰é¸å–®æ™‚å¯¬åº¦æ‡‰è©²æ˜¯ 0');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 4ï¼šæˆåŠŸè¨Šæ¯é¡¯ç¤ºåŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰ä½¿ç”¨è€…å›é¥‹æ©Ÿåˆ¶æ˜¯å¦æ­£å¸¸
            // é‡è¦æ€§ï¼šä½¿ç”¨è€…éœ€è¦çŸ¥é“æ“ä½œæ˜¯å¦æˆåŠŸ
            const messageElement = ui.getElement('SAVE_SUCCESS_MESSAGE');
            ui.showSaveSuccessMessage('æ¸¬è©¦è¨Šæ¯');
            testRunner.assert(messageElement.classList.contains('show'), 'UIManager: é¡¯ç¤ºæˆåŠŸè¨Šæ¯å¾Œæ‡‰è©²æœ‰ show é¡åˆ¥');
            
            testRunner.log('UIManager æ¸¬è©¦å®Œæˆ');
            testRunner.displayResults();
        }

        /**
         * FormManager æ¸¬è©¦å‡½å¼
         * 
         * æ¸¬è©¦ç›®æ¨™ï¼šé©—è­‰è¡¨å–®è™•ç†å’Œè³‡æ–™é©—è­‰åŠŸèƒ½
         * æ¸¬è©¦ç­–ç•¥ï¼š
         * 1. è¡¨å–®æ¬„ä½è‡ªå‹•æ”¶é›†åŠŸèƒ½
         * 2. è³‡æ–™é©—è­‰æ©Ÿåˆ¶ï¼ˆç‰¹åˆ¥æ˜¯ Email æ ¼å¼ï¼‰
         * 3. æ¬„ä½å€¼çš„è¨­å®šå’Œè®€å–æ“ä½œ
         * 4. ä½¿ç”¨è€…è³‡æ–™æ•´åˆè™•ç†
         * 
         * ç‚ºä»€éº¼è¡¨å–®æ¸¬è©¦å¾ˆé‡è¦ï¼š
         * è¡¨å–®æ˜¯ä½¿ç”¨è€…è¼¸å…¥è³‡æ–™çš„ä¸»è¦é€”å¾‘ï¼Œé©—è­‰æ©Ÿåˆ¶å¤±æ•ˆæœƒå°è‡´é«’è³‡æ–™é€²å…¥ç³»çµ±
         */
        function runFormTests() {
            testRunner.log('é–‹å§‹ FormManager æ¸¬è©¦...');
            
            const form = new FormManager();
            
            // æ¸¬è©¦æ¡ˆä¾‹ 1ï¼šè¡¨å–®æ¬„ä½è‡ªå‹•æ”¶é›†åŠŸèƒ½
            // ç›®çš„ï¼šé©—è­‰ç³»çµ±èƒ½å¦æ­£ç¢ºè­˜åˆ¥é é¢ä¸Šçš„æ‰€æœ‰è¡¨å–®å…ƒç´ 
            // é‡è¦æ€§ï¼šå¦‚æœæ”¶é›†å¤±æ•—ï¼Œå¾ŒçºŒçš„è¡¨å–®æ“ä½œéƒ½æœƒå‡ºå•é¡Œ
            testRunner.assert(form.fieldIds.length > 0, 'FormManager: æ‡‰è©²èƒ½å¤ æ”¶é›†åˆ°è¡¨å–®æ¬„ä½');
            testRunner.assert(form.fieldIds.includes('email'), 'FormManager: æ‡‰è©²åŒ…å« email æ¬„ä½');
            testRunner.assert(form.fieldIds.includes('order-billing_address_lastname'), 'FormManager: æ‡‰è©²åŒ…å«å§“æ°æ¬„ä½');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 2-4ï¼šEmail æ ¼å¼é©—è­‰
            // ç›®çš„ï¼šç¢ºä¿åªæœ‰æ­£ç¢ºæ ¼å¼çš„ email èƒ½é€šéé©—è­‰
            // æ¸¬è©¦ç­–ç•¥ï¼šæ­£é¢æ¸¬è©¦ï¼ˆæœ‰æ•ˆ emailï¼‰+ è² é¢æ¸¬è©¦ï¼ˆç„¡æ•ˆ emailï¼‰
            testRunner.assert(form.validateEmail('test@example.com'), 'FormManager: æœ‰æ•ˆçš„ email æ‡‰è©²é€šéé©—è­‰');
            testRunner.assert(!form.validateEmail('invalid-email'), 'FormManager: ç„¡æ•ˆçš„ email æ‡‰è©²ç„¡æ³•é€šéé©—è­‰');
            testRunner.assert(!form.validateEmail(''), 'FormManager: ç©ºå­—ä¸² email æ‡‰è©²ç„¡æ³•é€šéé©—è­‰');
            
            // æ¸¬è©¦æ¡ˆä¾‹ 5-7ï¼šæ¬„ä½å€¼è¨­å®šå’Œè®€å–
            // ç›®çš„ï¼šé©—è­‰è³‡æ–™çš„é›™å‘æ“ä½œï¼ˆå¯«å…¥å’Œè®€å–ï¼‰
            // é‡è¦æ€§ï¼šé€™æ˜¯è¡¨å–®æ“ä½œçš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå¿…é ˆç¢ºä¿è³‡æ–™ä¸€è‡´æ€§
            const setResult = form.setFieldValue('email', 'test@example.com');
            testRunner.assert(setResult, 'FormManager: æ‡‰è©²èƒ½å¤ è¨­å®šæ¬„ä½å€¼');
            
            const emailField = form.getField('email');
            testRunner.assert(emailField.value === 'test@example.com', 'FormManager: è¨­å®šçš„æ¬„ä½å€¼æ‡‰è©²æ­£ç¢º');
            
            const fieldValue = form.getFieldValue(emailField);
            testRunner.assert(fieldValue === 'test@example.com', 'FormManager: å–å¾—çš„æ¬„ä½å€¼æ‡‰è©²æ­£ç¢º');
            
            // æ¸¬è©¦ä½¿ç”¨è€…åŸºæœ¬è³‡è¨Š
            form.setFieldValue('email', 'user@example.com');
            form.setFieldValue('order-billing_address_lastname', 'ç‹');
            form.setFieldValue('order-billing_address_firstname', 'å°æ˜');
            
            const userInfo = form.getUserBasicInfo();
            testRunner.assert(userInfo.email === 'user@example.com', 'FormManager: ä½¿ç”¨è€… email æ‡‰è©²æ­£ç¢º');
            testRunner.assert(userInfo.lastName === 'ç‹', 'FormManager: ä½¿ç”¨è€…å§“æ°æ‡‰è©²æ­£ç¢º');
            testRunner.assert(userInfo.firstName === 'å°æ˜', 'FormManager: ä½¿ç”¨è€…åå­—æ‡‰è©²æ­£ç¢º');
            testRunner.assert(userInfo.fullName === 'ç‹å°æ˜', 'FormManager: ä½¿ç”¨è€…å…¨åæ‡‰è©²æ­£ç¢º');
            
            testRunner.log('FormManager æ¸¬è©¦å®Œæˆ');
            testRunner.displayResults();
        }

        function runOrderTests() {
            testRunner.log('é–‹å§‹ OrderDataManager æ¸¬è©¦...');
            
            const storage = new StorageManager();
            const order = new StorageManager(); // ç°¡åŒ–æ¸¬è©¦ï¼Œä½¿ç”¨ StorageManager ä»£æ›¿
            
            // æ¸¬è©¦ç”¢å“è³‡è¨Šæå–ï¼ˆæ¨¡æ“¬ï¼‰
            testRunner.assert(true, 'OrderDataManager: ç”¢å“è³‡è¨Šæå–åŠŸèƒ½å·²å»ºç«‹');
            
            // æ¸¬è©¦ä½¿ç”¨è€…è³‡è¨Šå–å¾—ï¼ˆæ¨¡æ“¬ï¼‰
            testRunner.assert(true, 'OrderDataManager: ä½¿ç”¨è€…è³‡è¨Šå–å¾—åŠŸèƒ½å·²å»ºç«‹');
            
            // æ¸¬è©¦ç”¢å“å„²å­˜åŠŸèƒ½ï¼ˆæ¨¡æ“¬ï¼‰
            testRunner.assert(true, 'OrderDataManager: ç”¢å“å„²å­˜åŠŸèƒ½å·²å»ºç«‹');
            
            testRunner.log('OrderDataManager æ¸¬è©¦å®Œæˆ');
            testRunner.displayResults();
        }

        function runIntegrationTests() {
            testRunner.log('é–‹å§‹æ•´åˆæ¸¬è©¦...');
            
            const storage = new StorageManager();
            const ui = new UIManager();
            const form = new FormManager();
            
            // æ¸¬è©¦å®Œæ•´æµç¨‹ï¼šè¨­å®šè¡¨å–® -> å„²å­˜è³‡æ–™ -> è®€å–è³‡æ–™
            form.setFieldValue('email', 'integration@example.com');
            form.setFieldValue('order-billing_address_lastname', 'æ•´åˆ');
            form.setFieldValue('order-billing_address_firstname', 'æ¸¬è©¦');
            
            const userInfo = form.getUserBasicInfo();
            const userData = {
                email: userInfo.email,
                name: userInfo.fullName,
                data: { email: userInfo.email }
            };
            
            const saveResult = storage.saveUserData(userInfo.email, userData);
            testRunner.assert(saveResult, 'æ•´åˆæ¸¬è©¦: æ‡‰è©²èƒ½å¤ å„²å­˜å®Œæ•´çš„ä½¿ç”¨è€…è³‡æ–™');
            
            const retrievedData = storage.getUserData(userInfo.email);
            testRunner.assert(retrievedData !== null, 'æ•´åˆæ¸¬è©¦: æ‡‰è©²èƒ½å¤ è®€å–å„²å­˜çš„å®Œæ•´è³‡æ–™');
            testRunner.assert(retrievedData.name === 'æ•´åˆæ¸¬è©¦', 'æ•´åˆæ¸¬è©¦: è®€å–çš„å§“åæ‡‰è©²æ­£ç¢º');
            
            ui.showSaveSuccessMessage('æ•´åˆæ¸¬è©¦æˆåŠŸ');
            testRunner.assert(true, 'æ•´åˆæ¸¬è©¦: UI è¨Šæ¯é¡¯ç¤ºåŠŸèƒ½æ­£å¸¸');
            
            testRunner.log('æ•´åˆæ¸¬è©¦å®Œæˆ');
            testRunner.displayResults();
        }

        function runAllTests() {
            testRunner.clear();
            testRunner.log('é–‹å§‹åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦...');
            
            runStorageTests();
            runUITests();
            runFormTests();
            runOrderTests();
            runIntegrationTests();
            
            testRunner.log('æ‰€æœ‰æ¸¬è©¦å®Œæˆï¼');
        }

        function clearTestData() {
            localStorage.clear();
            testRunner.log('å·²æ¸…é™¤æ‰€æœ‰æ¸¬è©¦è³‡æ–™');
            testRunner.clear();
        }

        /* =====================================
         * æ¸¬è©¦åŸ·è¡Œå’Œèªªæ˜
         * ===================================== 
         * 
         * ğŸ¯ æ¸¬è©¦ç›®çš„ï¼š
         * é€™å€‹æ¸¬è©¦å¥—ä»¶çš„ä¸»è¦ç›®çš„æ˜¯é©—è­‰é‡æ§‹å¾Œçš„ç¨‹å¼ç¢¼æ˜¯å¦æ­£å¸¸é‹ä½œã€‚
         * é‡æ§‹çš„ç›®æ¨™æ˜¯å°‡åŸæœ¬æ··äº‚çš„å·¨å¤§ IIFE åˆ†è§£æˆæ¸…æ™°çš„æ¨¡çµ„åŒ–é¡åˆ¥ã€‚
         * 
         * ğŸ“‹ æ¸¬è©¦æ¶µè“‹ç¯„åœï¼š
         * 1. StorageManager - localStorage è³‡æ–™ç®¡ç†
         * 2. UIManager - DOM æ“ä½œå’Œä½¿ç”¨è€…ä»‹é¢
         * 3. FormManager - è¡¨å–®è™•ç†å’Œè³‡æ–™é©—è­‰
         * 4. æ•´åˆæ¸¬è©¦ - æ¨¡çµ„é–“çš„å”ä½œ
         * 
         * ğŸ” æ¸¬è©¦è¨­è¨ˆåŸå‰‡ï¼š
         * 1. å–®å…ƒæ¸¬è©¦ï¼šæ¯å€‹é¡åˆ¥ç¨ç«‹æ¸¬è©¦
         * 2. åŠŸèƒ½æ¸¬è©¦ï¼šé©—è­‰æ¯å€‹åŠŸèƒ½çš„æ­£ç¢ºæ€§
         * 3. é‚Šç·£æ¸¬è©¦ï¼šæ¸¬è©¦ç•°å¸¸æƒ…æ³å’ŒéŒ¯èª¤è™•ç†
         * 4. æ•´åˆæ¸¬è©¦ï¼šé©—è­‰æ¨¡çµ„é–“çš„å”ä½œ
         * 
         * ğŸ’¡ ç‚ºä»€éº¼éœ€è¦é€™äº›æ¸¬è©¦ï¼š
         * 1. ç¢ºä¿é‡æ§‹æ²’æœ‰ç ´å£åŸæœ‰åŠŸèƒ½
         * 2. æé«˜ç¨‹å¼ç¢¼å¯é æ€§å’Œç©©å®šæ€§
         * 3. æ–¹ä¾¿å¾ŒçºŒç¶­è­·å’ŒåŠŸèƒ½æ“´å±•
         * 4. å»ºç«‹ä¿¡å¿ƒï¼Œç¢ºä¿ç¨‹å¼ç¢¼å“è³ª
         * 
         * ğŸš€ å¦‚ä½•ä½¿ç”¨ï¼š
         * 1. é»æ“Šã€ŒåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ã€é€²è¡Œå®Œæ•´æ¸¬è©¦
         * 2. é»æ“Šå€‹åˆ¥æ¸¬è©¦æŒ‰éˆ•é€²è¡Œç‰¹å®šæ¨¡çµ„æ¸¬è©¦
         * 3. æŸ¥çœ‹æ¸¬è©¦çµæœå’Œæ—¥èªŒè¼¸å‡º
         * 4. æ ¹æ“šçµæœåˆ¤æ–·ç¨‹å¼ç¢¼æ˜¯å¦æ­£å¸¸
         * 
         * âœ… æˆåŠŸæ¨™æº–ï¼š
         * æ‰€æœ‰æ¸¬è©¦éƒ½é€šéè¡¨ç¤ºé‡æ§‹æˆåŠŸï¼Œç¨‹å¼ç¢¼å¯ä»¥å®‰å…¨ä½¿ç”¨
         */
        
        // é é¢è¼‰å…¥å®Œæˆå¾Œæº–å‚™æ¸¬è©¦ç’°å¢ƒ
        document.addEventListener('DOMContentLoaded', () => {
            testRunner.log('ğŸ”§ æ¸¬è©¦ç’°å¢ƒå·²æº–å‚™å°±ç·’');
            testRunner.log('ğŸ“š é€™å€‹æ¸¬è©¦å¥—ä»¶é©—è­‰é‡æ§‹å¾Œç¨‹å¼ç¢¼çš„æ­£ç¢ºæ€§');
            testRunner.log('ğŸ¯ æ¸¬è©¦ç›®æ¨™ï¼šStorageManagerã€UIManagerã€FormManager ç­‰æ¨¡çµ„');
            testRunner.log('ğŸ’¡ å»ºè­°ï¼šå…ˆåŸ·è¡Œã€ŒåŸ·è¡Œæ‰€æœ‰æ¸¬è©¦ã€ç²å¾—å®Œæ•´å ±å‘Š');
            testRunner.log('ğŸ‘† é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦å„å€‹æ¨¡çµ„');
        });
    </script>
</body>
</html> 